angular.module("ecstatic.videoplayer").factory("videoplayerServices",["$rootScope","$sce","$stateParams","ConfigService","socket","socketManager","$timeout",function(e,t,o,a,n,s,i){var r={},c=[];return r.sources=[],r.setChannel=function(e){r.currentItem=e.playlistIndex,r.autoplay=!0,r.channel=e,r.theme="http://www.videogular.com/styles/themes/default/latest/videogular.css",r.loadVideoSources()},r.loadVideoSources=function(){var e=r.channel.cliplist;c=[];for(var o=0;o<e.length;o++)e[o].isActive&&c.push([{sources:[{src:t.trustAsResourceUrl("https://s3.amazonaws.com/ecstatic-videos/"+e[o].video_key),type:"video/"+e[o].format}]}])},r.getNumberOfActiveClips=function(e){for(var t=0,o=0;o<e.length;o++)e[o].isActive&&t++;return t},r.onLoadMetaData=function(e){r.API.seekTime(r.delta,!1),r.API.mediaElement[0].removeEventListener("loadedmetadata",this.onLoadMetaData.bind(this),!1),r.API.setVolume(0)},r.onVideoplayerReady=function(e){r.API=e,r.API.mediaElement[0].addEventListener("loadedmetadata",this.onLoadMetaData.bind(this),!1),r.setItem(r.currentItem),r.delta=(r.channel.requestTime-r.channel.timestamp)/1e3},r.onCompleteItem=function(){r.currentItem++,r.delta=0,r.currentItem>=c.length&&(r.currentItem=0),r.setItem(r.currentItem)},r.setItem=function(e){r.API.stop(),r.sources=c[e][0].sources,i(r.API.play.bind(r.API),100)},r}]).service("videoEventServices",["$rootScope",function(e){this.broadcast=function(t){e.$broadcast("videoAdded",t)},this.listen=function(t){e.$on("videoAdded",t)}}]);