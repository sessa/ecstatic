angular.module("ecstatic.camera").factory("cameraServices",["cameraEventServices","playerServices","socketManager",function(e,a,t){var r,o,i,n,c={};return c.cameraStart=function(){window.navigator.getUserMedia=window.navigator.getUserMedia||window.navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia||window.navigator.msGetUserMedia||window.navigator.oGetUserMedia;var a=function(a){o=URL.createObjectURL(a),e.broadcastVideoSource(o),r=new MediaStreamRecorder(a),r.mimeType="video/webm",r.ondataavailable=function(a){n=a,i=URL.createObjectURL(a),e.broadcastVideoSource(i),r.stop()}},t=function(e){};window.navigator.getUserMedia({video:!0},a,t)},c.startVideoClip=function(){e.broadcastVideoSource(o),r.start(1e4)},c.endVideoClip=function(){r.stop(),e.broadcastVideoSource(i)},c.deleteCurrentBlob=function(){n=""},c.getCurrentBlob=function(){return n?n:void 0},c.sendVideo=function(e){var a={msg:"send_video",channel_id:e,username:c.username,isActive:!0,video_key:""+c.username+"_"+(new Date).getTime()+".webm",video:c.getCurrentBlob(),format:"webm",hasVideo:!0},r=t.sendRequest(a);return r},c.sendMobileVideo=function(e,a){var r={msg:"send_video",channel_id:e,username:c.username,isActive:!0,video_key:""+c.username+"_"+(new Date).getTime()+".mp4",video:a,format:"mp4",hasVideo:!0},o=t.sendRequest(r);return o},e.listenCameraStart(function(e,a){c.cameraStart(a)}),c}]).service("cameraEventServices",["$rootScope",function(e){this.broadcastVideoSource=function(a){e.$broadcast("video_source",a)},this.listenVideoSource=function(a){e.$on("video_source",a)},this.broadcastCameraStart=function(a){e.$broadcast("camera_start",a)},this.listenCameraStart=function(a){e.$on("camera_start",a)}}]);