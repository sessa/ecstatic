angular.module("ecstatic.camera").factory("cameraServices",["cameraEventServices","playerServices","socketManager",function(e,a,t){var o,r,i,n,c={};return c.cameraStart=function(){window.navigator.getUserMedia=window.navigator.getUserMedia||window.navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia||window.navigator.msGetUserMedia||window.navigator.oGetUserMedia;var a=function(a){r=URL.createObjectURL(a),e.broadcastVideoSource(r),o=new MediaStreamRecorder(a),o.mimeType="video/webm",o.ondataavailable=function(a){n=a,i=URL.createObjectURL(a),e.broadcastVideoSource(i),o.stop()}},t=function(e){console.log(e)};window.navigator.getUserMedia({video:!0},a,t)},c.startVideoClip=function(){e.broadcastVideoSource(r),o.start(1e4)},c.endVideoClip=function(){o.stop(),e.broadcastVideoSource(i)},c.deleteCurrentBlob=function(){n=""},c.getCurrentBlob=function(){return n?n:void 0},c.sendVideo=function(e){var a={msg:"send_video",channel_id:e,username:c.username,isActive:!0,video_key:""+c.username+"_"+(new Date).getTime()+".webm",video:c.getCurrentBlob(),format:"webm",hasVideo:!0},o=t.sendRequest(a);return o},c.sendMobileVideo=function(e,a){var o={msg:"send_video",channel_id:e,username:c.username,isActive:!0,video_key:""+c.username+"_"+(new Date).getTime()+".mp4",video:a,format:"mp4",hasVideo:!0};console.log("channel_id: "+e);var r=t.sendRequest(o);return r},e.listenCameraStart(function(e,a){c.cameraStart(a)}),c}]).service("cameraEventServices",["$rootScope",function(e){this.broadcastVideoSource=function(a){e.$broadcast("video_source",a)},this.listenVideoSource=function(a){e.$on("video_source",a)},this.broadcastCameraStart=function(a){e.$broadcast("camera_start",a)},this.listenCameraStart=function(a){e.$on("camera_start",a)}}]);